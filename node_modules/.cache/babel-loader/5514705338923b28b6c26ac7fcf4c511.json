{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"/Users/lukeshinn/repos/samples-js-react/okta-hosted-login/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/*\n * Copyright (c) 2018, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */import{useOktaAuth}from'@okta/okta-react';import React,{useState,useEffect}from'react';import{Header,Icon,Message,Table}from'semantic-ui-react';import config from'./config';var Messages=function Messages(){var _useOktaAuth=useOktaAuth(),authState=_useOktaAuth.authState,oktaAuth=_useOktaAuth.oktaAuth;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),messageFetchFailed=_useState4[0],setMessageFetchFailed=_useState4[1];// fetch messages\nuseEffect(function(){if(authState.isAuthenticated){var accessToken=oktaAuth.getAccessToken();fetch(config.resourceServer.messagesUrl,{headers:{Authorization:\"Bearer \".concat(accessToken)}}).then(function(response){if(!response.ok){return Promise.reject();}return response.json();}).then(function(data){var index=0;var formattedMessages=data.messages.map(function(message){var date=new Date(message.date);var day=date.toLocaleDateString();var time=date.toLocaleTimeString();index+=1;return{date:\"\".concat(day,\" \").concat(time),text:message.text,id:\"message-\".concat(index)};});setMessages(formattedMessages);setMessageFetchFailed(false);}).catch(function(err){setMessageFetchFailed(true);/* eslint-disable no-console */console.error(err);});}},[authState]);var possibleErrors=['You\\'ve downloaded one of our resource server examples, and it\\'s running on port 8000.','Your resource server example is using the same Okta authorization server (issuer) that you have configured this React application to use.'];return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Header,{as:\"h1\",children:[/*#__PURE__*/_jsx(Icon,{name:\"mail outline\"}),\"My Messages\"]}),messageFetchFailed&&/*#__PURE__*/_jsx(Message,{error:true,header:\"Failed to fetch messages.  Please verify the following:\",list:possibleErrors}),!messages&&!messageFetchFailed&&/*#__PURE__*/_jsx(\"p\",{children:\"Fetching Messages..\"}),messages&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"This component makes a GET request to the resource server example, which must be running at\",/*#__PURE__*/_jsx(\"code\",{children:\"localhost:8000/api/messages\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"It attaches your current access token in the\",' ',/*#__PURE__*/_jsx(\"code\",{children:\"Authorization\"}),' ',\"header on the request, and the resource server will attempt to authenticate this access token. If the token is valid the server will return a list of messages.  If the token is not valid or the resource server is incorrectly configured, you will see a 401\",' ',/*#__PURE__*/_jsx(\"code\",{children:\"Unauthorized response\"}),\".\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"This route is protected with the\",' ',/*#__PURE__*/_jsx(\"code\",{children:\"<SecureRoute>\"}),' ',\"component, which will ensure that this page cannot be accessed until you have authenticated and have an access token in local storage.\"]}),/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Message\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:messages.map(function(message){return/*#__PURE__*/_jsxs(\"tr\",{id:message.id,children:[/*#__PURE__*/_jsx(\"td\",{children:message.date}),/*#__PURE__*/_jsx(\"td\",{children:message.text})]},message.id);})})]})]})]});};export default Messages;","map":{"version":3,"sources":["/Users/lukeshinn/repos/samples-js-react/okta-hosted-login/src/Messages.jsx"],"names":["useOktaAuth","React","useState","useEffect","Header","Icon","Message","Table","config","Messages","authState","oktaAuth","messages","setMessages","messageFetchFailed","setMessageFetchFailed","isAuthenticated","accessToken","getAccessToken","fetch","resourceServer","messagesUrl","headers","Authorization","then","response","ok","Promise","reject","json","data","index","formattedMessages","map","message","date","Date","day","toLocaleDateString","time","toLocaleTimeString","text","id","catch","err","console","error","possibleErrors"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2018, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport { useOktaAuth } from '@okta/okta-react';\nimport React, { useState, useEffect } from 'react';\nimport { Header, Icon, Message, Table } from 'semantic-ui-react';\n\nimport config from './config';\n\nconst Messages = () => {\n  const { authState, oktaAuth } = useOktaAuth();\n  const [messages, setMessages] = useState(null);\n  const [messageFetchFailed, setMessageFetchFailed] = useState(false);\n\n  // fetch messages\n  useEffect(() => {\n    if (authState.isAuthenticated) {\n      const accessToken = oktaAuth.getAccessToken();\n      fetch(config.resourceServer.messagesUrl, {\n        headers: {\n          Authorization: `Bearer ${accessToken}`,\n        },\n      })\n        .then((response) => {\n          if (!response.ok) {\n            return Promise.reject();\n          }\n          return response.json();\n        })\n        .then((data) => {\n          let index = 0;\n          const formattedMessages = data.messages.map((message) => {\n            const date = new Date(message.date);\n            const day = date.toLocaleDateString();\n            const time = date.toLocaleTimeString();\n            index += 1;\n            return {\n              date: `${day} ${time}`,\n              text: message.text,\n              id: `message-${index}`,\n            };\n          });\n          setMessages(formattedMessages);\n          setMessageFetchFailed(false);\n        })\n        .catch((err) => {\n          setMessageFetchFailed(true);\n          /* eslint-disable no-console */\n          console.error(err);\n        });\n    }\n  }, [authState]);\n\n  const possibleErrors = [\n    'You\\'ve downloaded one of our resource server examples, and it\\'s running on port 8000.',\n    'Your resource server example is using the same Okta authorization server (issuer) that you have configured this React application to use.',\n  ];\n\n  return (\n    <div>\n      <Header as=\"h1\">\n        <Icon name=\"mail outline\" />\n        My Messages\n      </Header>\n      {messageFetchFailed && <Message error header=\"Failed to fetch messages.  Please verify the following:\" list={possibleErrors} />}\n      {!messages && !messageFetchFailed && <p>Fetching Messages..</p>}\n      {messages\n      && (\n      <div>\n        <p>\n          This component makes a GET request to the resource server example, which must be running at\n          <code>localhost:8000/api/messages</code>\n        </p>\n        <p>\n          It attaches your current access token in the\n          {' '}\n          <code>Authorization</code>\n          {' '}\n          header on the request,\n          and the resource server will attempt to authenticate this access token.\n          If the token is valid the server will return a list of messages.  If the token is not valid\n          or the resource server is incorrectly configured, you will see a 401\n          {' '}\n          <code>Unauthorized response</code>\n          .\n        </p>\n        <p>\n          This route is protected with the\n          {' '}\n          <code>&lt;SecureRoute&gt;</code>\n          {' '}\n          component, which will\n          ensure that this page cannot be accessed until you have authenticated and have an access token in local storage.\n        </p>\n        <Table>\n          <thead>\n            <tr>\n              <th>Date</th>\n              <th>Message</th>\n            </tr>\n          </thead>\n          <tbody>\n            {messages.map((message) => (\n              <tr id={message.id} key={message.id}>\n                <td>{message.date}</td>\n                <td>{message.text}</td>\n              </tr>\n            ))}\n          </tbody>\n        </Table>\n      </div>\n      )}\n    </div>\n  );\n};\n\nexport default Messages;\n"]},"metadata":{},"sourceType":"module"}